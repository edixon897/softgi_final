<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Muestra ventas</title>
    <link href="https://cdn.lineicons.com/4.0/lineicons.css" rel="stylesheet">
    <link rel="stylesheet" href="../../static/css/ventas/muestra_ventas.css">
</head>
<body>

    <main id="cuerpo">

        <section id="conten_registra_pago" onclick="cerrarModal_2()">

            <div id="modalContenedor_2" onclick="detenerPropagacion(event)" style="display: none; opacity: 0;"></div>

        </section>

        <section id="section_1">
            <p>Historial de ventas</p>
        </section>


        <section id="section_2">

            <div id="conten_botones">
                <div id="conten_regresar">
                        <a href="{{url_for ('inicio') }}" id="isla_1">
                            <i id="boton_back" class="lni lni-home"></i>
                        </a>
                </div>
                <div id="conten_btn_navegacion">
                    <div id="isla_2">
                        <a class="botones" href="{{url_for('muestra_ventas_credito')}}">Ventas a crédito</a>
                        <a class="botones"  href="{{url_for('verCrear_ventas')}}">Nueva venta</a>
                    </div>
                </div>
            </div>

            <div id="conten_tabla">

                <div id="isla_3">
                    <section id="section_buscador_titulo">
                        
                        <div id="conten_titulo">
                            <p>Todas mis ventas</p>
                        </div>
                        <form id="form_conten">
                            <i id="icono_busqueda" class="lni lni-search-alt"></i>
                            <input type="search" id="buscador_ventas" name="buscador_ventas" placeholder="Buscar por nombre del cliente o número de factura">

                        </form>

                    </section>
                    <section id="section_tabla_info">
                        <div id="conten_t">
                            <table id="tablaVentas">
                                <thead>
                                    <tr>
                                        <th>Número de factura</th>
                                        <th>C.C cliente</th>
                                        <th>Nombre del cliente</th>
                                        <th>Vendedor</th>
                                        <th>Fecha de venta</th>
                                        <th>Forma de pago</th>
                                        <th>Más detalles</th>
                                    </tr>
                                </thead>
                            
                                <tbody>
                                    {% for c in resul %}
                                    <tr>
                                        {% for i in range(0, 6) %}
                                            {% if i == 5 %} {# Para la primera columna, que es la factura # #}
                                                <td class="{% if c[i] == 'efectivo' %} clase1 {% elif c[i] == 'Daviplata' %} clase2 {% elif c[i] == 'Bancolombia' %} clase3 {% elif c[i] == 'Nequi' %} clase4 {% elif c[i] == 'Tarjeta cred' %} clase5 {% endif %}">{{ c[i] }}</td>
                                                
                                            {% else %} {# Para las otras columnas, puedes agregar más lógica según sea necesario #}
                                                <td>{{ c[i] }}</td>
                                            {% endif %}
                                        {% endfor %}
                                        <td class="btns_centro">
                                            <!-- <a href="{{ url_for('muestra_detalles_ventas', num_factura=c[0]) }}"><i id="icono_ver_mas" class="lni lni-information"></i></a> -->
                                            <a href="#" onclick="abrirModal_2('{{c[0]}}')">
                                                <i id="icono_ver_mas" class="lni lni-comments-alt-2"></i>
                                            </a>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                                <p id="noResults" style="display: none;">No se encontraron resultados</p>
                            </table>
                        </div>
                    </section>

                </div>

            </div>

        </section>

    </main>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
   <!--  <script>
        var tablaOriginal;  // Variable para almacenar la tabla original antes de realizar la búsqueda
    
        $(document).ready(function() {
            // Guardar la tabla original cuando se carga el documento
            tablaOriginal = $('#tablaVentas tbody').html();
    
            $('#buscador_ventas').on('input', function() {
                var busqueda = $(this).val().trim();
                if (busqueda.length > 0) {
                    buscarEnTiempoReal(busqueda);
                } else {
                    restaurarTabla();
                }
            });
        });
        
        function buscarEnTiempoReal(busqueda) {
            $.ajax({
                type: 'POST',
                url: '/buscarVentas',
                data: { 'Busqueda': busqueda },
                success: function(response) {
                    actualizarTabla(response.result);
                },
                error: function(xhr, status, error) {
                    console.error('Error al realizar la búsqueda:', error);
                }
            });
        }
        
        function restaurarTabla() {
            // Eliminar filas duplicadas antes de restaurar la tabla original
            var tabla = $('#tablaVentas tbody');
            eliminarFilasDuplicadas(tabla);

            // Restaurar la tabla a su estado original
            tabla.empty();
            tabla.append(tablaOriginal);
            // Asignar eventos onclick de nuevo después de restaurar la tabla
            asignarEventosClick();
        }
        function eliminarFilasDuplicadas(tabla) {
            var seen = {};
            tabla.find('tr').each(function() {
                var txt = $(this).text();
                if (seen[txt]) $(this).remove();
                else seen[txt] = true;
            });
        }
        
        function actualizarTabla(data) {
            var tabla = $('#tablaVentas tbody');
            tabla.empty();
            if (data.length > 0) {
                $.each(data, function(index, row) {
                    var tr = $('<tr>');
                    $.each(row, function(key, value) {
                        $('<td>').text(value).appendTo(tr);
                    });
                    // Mantener visible el botón de "Más detalles" incluso después de la búsqueda
                    $('<td class="btns_centro"><a href="#" class="ver_detalle"><i id="icono_ver_mas" class="lni lni-information"></i></a></td>').appendTo(tr);
                    tabla.append(tr);
                });
                // Asignar eventos onclick después de actualizar la tabla
                asignarEventosClick();
            } else {
                tabla.append('<tr><td colspan="7">No se encontraron resultados</td></tr>');
            }
        }
    
        function asignarEventosClick() {
            $('.ver_detalle').on('click', function(e) {
                e.preventDefault();
                var num_factura = $(this).closest('tr').find('td:first').text(); // Obtener el número de factura de la fila actual
                abrirModal_2(num_factura);
            });
        }
    </script> -->
    

    <script src="/static/javaScript/buscadorVentas.js"></script>
</body>
</html>